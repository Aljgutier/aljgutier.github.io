---
title: "Bull and Bear Market Cycle Analysis in Python"
date: "2020-09-30"
author: Alberto Gutierrez
description: Financial markets, bull and bear markets, Jupyter notebook, machine learning, matplotlib
...
<span style="display:block; color:blue; margin-top:-40px;"> </span>
[about me](../../about.md)  &nbsp;   &nbsp;  &nbsp;  &nbsp;   &nbsp;   &nbsp;  &nbsp;  &nbsp; [home](../../index.md)

<script type="text/javascript" charset="utf-8"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,
https://vincenttam.github.io/javascripts/MathJaxLocal.js"></script>

<h1 style="color:	#115BDC;">Analyzing Bull and Bear Market Cycles in Python</h1>

<figure>
 <img alt="Bull and Bear Markets 1950 to 2020 SP500" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MarketCycle2.png" width="635">

 </figure>

by Alberto Gutierrez,  September 30, 2020

# Introduction

  This article is the first part of a three-part series of articles. Part 1 (this post) introduces software for analyzing Bull and Bear market conditions in the Python computer language. Ultimately the objective is to build a machine-learning algorithm to predict "Bull" upward trending and "Bear" downward trending market conditions. Creating the market prediction algorithm will employ a standard data science process described in Part 2. Part 2 explores and analyses additional data sources for use in the prediction model. In part 3, the machine learning algorithm is developed and backtested.

  Bull and Bear market conditions apply to stock markets such as the S&P 500 or NASDAQ. See [Investopedia Bear and Bull Markets](https://www.investopedia.com/insights/digging-deeper-bull-and-bear-markets/#:~:text=A%20bull%20market%20is%20a,stocks%20are%20declining%20in%20value.) for a general definition of Bull and Bear markets. In summary, the market will be in one of the two conditions where the market typically stays in an upward trend or Bull market condition for an extended period, often years. However, the market can switch to a downward trending market with typical periods ranging from as short as a month to over a year and termed a "Bear" market condition.

 Understanding and analyzing market cycles helps investors gain insight into familiar patterns, conditions, and influences on the market. These insights enable investors to plan investment strategies. In this article, two software tools are introduced for analyzing market cycles in the Python computer language. The *fmcycles()* function receives as input stock market data, such as S&P 500 daily close price, then retroactively analyzes it and marks the corresponding market dates as corresponding to Bull or Bear market conditions. Also, machine learning features, variables useful for prediction, are derived from the market cycle analysis. The second tool introduced in this article is the *fmplot()* function for plotting and quickly visualizing stock market data and market cycles.

 This article's content is listed below, including links to the software, several examples, a summary of machine learning variables generated by the tools, and finally, summary and conclusions.
  * [Github Links](#github-links)
  * [Initialization and Data Import](#initialization-and-data-import)
  * [Analyze Save and Load Market Cycles](#analyze-save-and-load-market-cycles)
  * [Market Cycle Summary](#market-cycle-summary)
  * [Market Cycle Visualization](#market-cycle-visualization)
  * [Recessions: Annotations and Fill-Between](#recessions-annotations-and-fill-between)
  * [Subplots with MktCycle and Line Plots](#subplots-with-mktcycle-and-line-plots)
  * [Zoom In](#zoom-in)
  * [Machine Learning Variables](#machine-learning-variables)
  * [Summary and Conclusions](#summary-and-conclusions)


# Github Links
 The programs and corresponding Jupyter nobebook are available as open source via Github at the following links
 * [fmcycle.py](https://github.com/Aljgutier/Pyquant/blob/master/fmcycle.py)
 * [fmplot.py](https://github.com/Aljgutier/Pyquant/blob/master/fmplot.py)
 * [mktcycle.ipynb](https://github.com/Aljgutier/Pyquant/blob/master/Market%20Cycle%20Notebook.ipynb)


# Initialization and Data Import
 The python code for the examples below is contained in the "Market Cycle Notebook" (link above) and available for download on Github.

 As with a typical data analysis, we begin by importing packages and modules. Since fmcycle.py and fmplot.py are not yet available within a Python package, it is required to download them and put them into a directory contained in the PYTHONPATH. Downloading the modules into the python/Jupyter working directory is typically the most straightforward approach.

```
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from datetime import datetime as dt
from datetime import timedelta as td
%run fmplot
%run fmcycle
```

Next, we import the S&P500 data by downloading the symbol "^GSPC" from Yahoo finance and save it in the "data" directory (./data relative to the python working directory). For this exercise, the market data begins on 1950-01-03 and ends on 2020-08-24.

```
# Read in S&P 500 Data
dfsp500 = pd.read_csv('./data/GSPC_1950-1-3_to_2020-8-24.csv',index_col=0,parse_dates=True)
display(dfsp500.head(2))
display(dfsp500.tail(2))
```


                Close	 High  	Low	 Open	 Volume	 Adj Close
    Date						
    1950-01-03	16.66	16.66	16.66	16.66	1260000.0	NaN
    1950-01-04	16.85	16.85	16.85	16.85	1890000.0	NaN

                Close	  High     Low     Open      Volume	    Adj Close
    Date						
    2020-08-21	3397.16	3399.96	3379.31	3386.01	3.705420e+09	3397.16
    2020-08-24	3431.28	3432.09	3413.12	3418.09	3.728690e+09	3431.28

# Analyze, Save, and Load the Market Cycles

The fmcycle.py module contains the *fmcycles()* function and it receives as input the *dfsp500* dataframe. When *compute* = 1 the market data is analyzed. The function returns the detailed ("daily") market cycle dataframe *dfmc* and summary market cycle dataframe *dfmcsummary*. Each is automatically saved to a csv file. If *compute* = 0 then *fmcycles()* expects to receive filenames to import the detailed and summary market cycle datafames and in this case does not analyze the input dataframe.

The three key parameters used for analyzing the daily market data are *mcdown_p*, *mcup_p*, and *variable*, defined as follows:
  * *mcdown_p* = the percent decline from market high determining a Bear market condition.
  * *mcup_p* = the percent increase from market low determining a Bull market.
  * the *variable* in the input data frame, *df*, to analyze, by default = *Close*

It is possible to set *mcdown_p* and *mcup_p* to other cycles, such as 10% corrections, rather than the 20% Bull and Bear conditions. Furthermore, it is also entirely possible to analyze the up and down cyclic performance of any security in this manner other than the ^GSPC. For long term evaluation of an Equity, instead of a market index, the correct variable for analysis will be *Adj Close*.

```
f_dfmc="./data/GSPC_dfmc2020.5_1950_2020-8-24.csv"
f_dfmcs="./data/GSPC_dfmcs2020.5_1950_2020-8-24.csv"

compute=0
mcycledown=20
mcycleup=20.5

dfmc,dfmcsummary=fmcycles(df=dfsp500,symbol='GSPC',compute=compute, mc_filename=f_dfmc, mcs_filename=f_dfmcs, mcdown_p=mcycledown,mcup_p=mcycleup,savedir="./data"

```

# Market Cycle Summary

Below, we display the *dfmcsummary* dataframe, which contains a summary of the market cycles. We will explore the detailed market cycles in the *dfmc* dataframe using the *fmplot()* function below. The *dfmcsummary* summary is in agreement with published S&P500 Bull and Bear markets. For example, compare to the the
[Seeking Alpha](https://seekingalpha.com/article/4199997-historical-bull-and-bear-markets-of-s-and-p-500) article, which contains a listing of historical Bull and Bear market S&P500 markets.

```
display(dfmcsummary)
```

       index      mkt	    startTime	   endTime	startPrice	endPrice	    mcnr
      1950-01-03 	 1.0	 1950-01-03	1956-08-02	16.660000	  49.639999	   1.979592
      1956-08-02	-1.0   1956-08-02	1957-10-22	49.639999	  38.980000	  -0.214746
      1957-10-22	 1.0	 1957-10-22	1961-12-12	38.980000	  72.639999	   0.863520
      1961-12-12	-1.0	 1961-12-12	1962-06-26	72.639999	  52.320000	  -0.279736
      1962-06-26	 1.0	 1962-06-26	1966-02-09	52.320000	  94.059998	   0.797783
      1966-02-09	-1.0	 1966-02-09	1966-10-07	94.059998	  73.199997	  -0.221773
      1966-10-07	 1.0	 1966-10-07	1968-11-29	73.199997	  108.370003	 0.480465
      1968-11-29	-1.0	 1968-11-29	1970-05-26	108.370003	69.290001	  -0.360616
      1970-05-26	 1.0	 1970-05-26	1973-01-11	69.290001	  120.239998 	 0.735315
      1973-01-11	-1.0	 1973-01-11	1974-10-03	120.239998	62.279999	  -0.482036
      1974-10-03	 1.0	 1974-10-03	1980-11-28	62.279999	  140.520004	 1.256262
      1980-11-28	-1.0	 1980-11-28	1982-08-12	140.520004	102.419998  -0.271136
      1982-08-12	 1.0	 1982-08-12	1987-08-25	102.419998	336.769989	 2.288127
      1987-08-25	-1.0	 1987-08-25	1987-12-04	336.769989	223.919998	-0.335095
      1987-12-04	 1.0	 1987-12-04	2000-03-24	223.919998	1527.459961	 5.821454
      2000-03-24	-1.0	 2000-03-24	2001-09-21	1527.459961	965.799988	-0.367708
      2001-09-21	 1.0	 2001-09-21	2002-01-04	965.799988	1172.510010	 0.214030
      2002-01-04	-1.0	 2002-01-04	2002-07-23	1172.510010	797.700012	-0.319665
      2002-07-23	 1.0	 2002-07-23	2007-10-09	797.700012	1565.150024	 0.962078
      2007-10-09	-1.0	 2007-10-09	2008-11-20	1565.150024	752.440002	-0.519254
      2008-11-20	 1.0	 2008-11-20	2009-01-06	752.440002	934.700012	 0.242225
      2009-01-06	-1.0	 2009-01-06	2009-03-09	934.700012	676.530029	-0.276206
      2009-03-09	 1.0	 2009-03-09	2020-02-19	676.530029	3386.149902	 4.005173
      2020-02-19	-1.0	 2020-02-19	2020-03-23	3386.149902	2237.399902	-0.339250
      2020-03-23	 1.0	 2020-03-23	NaT	        2237.399902	NaN      	   NaN

For each row we have the start date, end date, start price, and end price of the market variable (Close price). The *mkt* variable indicates if the market is in an up trending (1.0, Bull) condition or in a down trending (-1.0, Bear) condition. The *mcnr* (market cycle normalized return) variable is the normalized return of the Close price at the end of the cycle relative to the start date.  

# Market Cycle Visualization

We plot the detailed market cycle information with *fmplot()*, which is defined on top of [matplotlib](https://matplotlib.org/). We define a market cycle plot by use of a stem chart, with the use of colored stems, without a marker (at the top of the stem). To plot a market cycle style plot we set *plottype* ="mktcycle." We call the *fmplot()* function with the *variable* = *mcnr*. The *mcnr* variable was derived by *fmcycle()* and is contained in the detailed market cycle dataframe, dfmc. This variable is set to zero at the beginning of each market cycle. For a Bull market the variable increases (blue), until the last market high, prior to a 20% drop. Similarly, *mcnr* decreases from zero (red) until the market low prior to the market risng by 20.5% from the low. This is a classic chart used to visualize Bull and Bear markets, for example, look at the [Inveso](https://www.invesco.com/us-rest/contentdetail?contentId=049233173f5c3510VgnVCM100000c2f1bf0aRCRD&audienceType=investors) chart for comparison.

There are several additional options used in the example below. Setting *titlein* = TRUE appends the beginning and ending date of the input dataframe to the title. Most other inputs are easily understood. Documentation for all the input parameters is visible with Jupyter Shit+Tab feature.

```
title=['Bull and Bear Normalized Returns']
variables=['mcnr']
fmplot(dfmc,variables,titles=title,
          plottypes='mktcycle', stemlw=0.5,legend_fontsize=20,
          titlein=True, titlexy=(0.5,0.95), figsize=(18,10),titledate=True, title_fontsize=20)
```

<figure>
 <img alt="Bull and Bear Markets 1950 to 2020 SP500" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MarketCycle1.png" width="635">
 <figcaption>Figure 1. Bull and Bear market cycle plot.</figcaption>
 </figure>


 From this graph, it is evident that characterizing the market cycles requires retroactive analysis.

For example, finding a Bear market (down-trending market), assuming we start during Bull (blue) market condition, starting from earlier dates to later dates, we identify a market-high close price (initialize to the close price corresponding to the first day). Then, moving forward day-by-day, we monitor the close price relative to the previous high each day until a new high is found or the market falls by 20% relative to the market high. On the day the market falls by 20% relative to the market high, a Bear market is detected. At this point, we go back (retroactively) and fill in the dates from the high to the present day and mark the days as *mkt* = -1. The market days before the high are marked as *mkt* = 1, corresponding to the Bull market. The Bear market starts on the next market day following the previous high. The *mcnr* variable is set equal to zero at the beginning of the market cycle and, from that point forward to the present, indicates the percent decrease from the market high.

Similarly, once in a Bear market (downward trending market), a Bull market is detected when the market increases by greater than 20% relative to the market low. Once the market has increased by 20% from the market low, we go back (retroactively) and fill in the dates from the low to the present day and mark the days as *mkt* = 1. The market days before the market low, from the previous market high, are marked as *mkt* = -1, corresponding to the Bull market. The *mcnr* variable is set equal to zero at the beginning of the market cycle and, from that point forward to the present, indicates the percent increase from the market low.  

# Recessions: Annotations and Fill-Between

It is useful to add additional information to the plot, especially to generate plots for documentation and presentations.

A typical addition is to show recessions. fmplot.py contains the *get_recessions()* function, which returns a list of recessions in the form of tuples (start date, end date). These are graphed using the fb (fill between) option.

Next, we create lists of text annotations with descriptive titles for the Bull and Bear cycles and recessions. The list elements include a tuple including the corresponding x and y coordinate for the annotation and a text string. The text strings may contain a "\n" character to designate a line return.

```
# Recession Data
# get recessions and put in dataframe to make it look pretty

recessions = get_recessions()

# Bear Market and Recession Annotations

# Bear Market Annotations
bearannotations=[]
bearannotations.append((dt.datetime(1956,1,1),-1.1,'1956-57\nRed\nScare'))
bearannotations.append((dt.datetime(1961,1,1),-1.3,'1961-62\nSteel &\nTech\nCrash'))
bearannotations.append((dt.datetime(1965,4,1),-1.1,'1966\nCredit\nCrunch'))
bearannotations.append((dt.datetime(1969,4,1),-1.3,'1968-70\nDouble\nBottom\nBear'))
bearannotations.append((dt.datetime(1974,1,1),-1.1,'1973-74\nGolden\nBear'))
bearannotations.append((dt.datetime(1981,1,1),-1.1,'1980-82\nVolker\nBear'))
bearannotations.append((dt.datetime(1987,1,1),-1.1,'1987 Oct\nBlack\nMonday'))
bearannotations.append((dt.datetime(2000,1,1),-1.1,'2000-02\nDot Com\nBubble'))
bearannotations.append((dt.datetime(2007,1,1),-1.2,'2007-09\nFinancial\nCrisis'))
bearannotations.append((dt.datetime(2019,1,1),-1.1,'2020\nCOVID\nBear'))

# https://www.investopedia.com/articles/economics/08/past-recessions.asp
# Recession Annotations
recessionannotations=[]
recessionannotations.append((dt.datetime(1951,1,1),2.8,'1953-54\nPost\nKorean\nWar\nRecession','k'))
recessionannotations.append((dt.datetime(1956,1,1),3.8,'1957-58\nEisenhower\nRecession','k'))
recessionannotations.append((dt.datetime(1959,1,1),2.5,'1960-61\nRolling\nAdjustment\nRecession','k'))
recessionannotations.append((dt.datetime(1969,1,1),3.2,'1969-70\nNixon\nRecession','k'))
recessionannotations.append((dt.datetime(1973,1,1),2,'1973-75\nOil\nCrisis\nRecession','k'))
recessionannotations.append((dt.datetime(1978,1,1),3.8,'1980\nEnergy\nCrisis\nRecession','k'))
recessionannotations.append((dt.datetime(1981,1,1),2.5,'1981-82\nIran\nEnergy\nCrisis\nRecession','k'))
recessionannotations.append((dt.datetime(1990,1,1),2.8,'1990-91\nGulf\nWar\nRecession','k'))
recessionannotations.append((dt.datetime(2001,1,1),2.8,'2001\n9/11\nRecession','k'))
recessionannotations.append((dt.datetime(2007,1,1),2.8,'2007-09\nThe\nGreat\nRecession','k'))
recessionannotations.append((dt.datetime(2018,1,1),4.2,'2020\nCOVID-19\nRecession','k'))
```

The *fmplot()* function with fb and annotation options generates the classic Bear and Bull market cycle chart, including a display of recessions and descriptive text.

```
title=['Bull and Bear Normalized Returns']
variables=['mcnr']
fmplot(dfmc,variables,titles=title,fb=recessions,
          plottypes=['mktcycle'], stemlw=0.5, ylims=(-2,6.1), legend_fontsize=14,
          titlein=False, figsize=(18,10),titledate=True, title_fontsize=18,
          annotations=[bearannotations + recessionannotations])
```

<figure>
 <img alt="Bull and Bear Markets 1950 to 2020 SP500" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MarketCycle2.png" width="635">
 <figcaption> Figure 2. Bull and Bear market plot with annotations.</figcaption>
 </figure>

 Several insights result from this graph. Our objective is not to deep dive into classic market analysis, but especially to make observations that will aid in designing a machine learning model.
  * The first most apparent observations is the cyclic behavior of the market. It tends to rise, upward trend line (blue) then goes into a downward trend (red), followed by a repetition of the cycle.
  * The upward trend's length typically occurs for several years, wherein a growing market is the normal situation, but is interrupted by shorter length downward trends or crashes.
  * Recessions can occur without causing a market crash. For example, the Gulf War Recession or the post-Korean war recession occurred during Bull markets. Recessions tend to be reactionary to the market, rather than a leading indicator of the market. Often there are market crashes without recessions, and sometimes a recession follows a market crash.
  * We learn from various annotations that often outside forces are the instigators of crashes. A case in point is the 2020 COVID Pandemic. In this case, external forces had an enormous impact on the financial market. The pandemic crisis had nothing to do with financial markets, but the effect due to social distancing strongly impacted the workforce and business operations across most industries.
  * In some cases, the same trends that are driving the market up are the ones that bring the market down. Such a case is the 2007 - 2009 Financial Crisis, where the U.S. housing market, sub-prime mortgages, drove the market up and then brought the market down with the collapse of the U.S. housing market.
  * In many cases, assets are overvalued and are termed [asset bubbles](https://www.investopedia.com/articles/personal-finance/062315/five-largest-asset-bubbles-history.asp). In such cases, certain metrics, for example, price-to-earnings ratio, increase significantly above historical levels leading to straightforward prediction and consequently higher market impact. A case in point is the DoT Com Bubble, which led to unjustified multi-billion dollar valuations for some young companies that went public. Looking at Figure 3, we observe it took from 2000 to late 2007 to regain the lost market value lost in the Dot Com Bubble.

 From these observations, it is evident that outside factors have a strong influence on the market. Thus, additional data sources that capture the effects of external forces should be useful for predicting market downturns. We will explore additional data sources in part 2 of this series.

# Subplots with MktCycle and Line Plots

When analyzing variables and trends, it is useful to compare multiple market variables. For example, it is beneficial to examine the *mcnr* and compare it to the close price. Here we provide *fmplot()* a list of variables to be plotted along with a list of plot types. We also set *hspace* = 0, calling for no space between the subplots. More details for these features are available by examining the *fmplot()* "docstrings" with the Jupyter shift+Tab feature.

```
title=['Bull and Bear Normalized Returns', 'Close Price']
variables=['mcnr','Close']
fmplot(dfmc,variables,titles=title,stemlw=2,fb=recessions,
          plottypes=['mktcycle','line'],legend_fontsize=14,llocs=['upper left','best'], hspace=0, titlein=True, figsize=(18,10),titledate=True)
```


<figure>
 <img alt="Bull and Bear Markets 1950 to 2020 SP500" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MarketCycleAndSPClose.png" width="635">
 <figcaption>Figure 3. Subplots: market cycle plot and Close Price line plot.</figcaption>
 </figure>

# Zoom In

 The previous graph displays the entire length of the dataframe from the start date in 1950 to the end date in 2020. It is useful to zoom in and examine narrow ranges of time. Below we zoom into a one-month interval from February 1, 2020, to March 1, 2020 (Figure 4a). The top graph plots *Close* as a line graph and the bottom subgraph plots *mcnr* as mktcyle plot. Here we can see the first day of the COVID Bear beginning on Thursday, February 20. We also can observe the rapid market crash ensuing after February 20. The market was up 400% relative to the start of the Bull on March 9, 2009 (see dfmcsummary above). In the following graph (Figure 4b), we observe the entire Bear market cycle along with the close price by setting dates between February 1, 2020, and April 1, 2020.

```
figsize=(18,8)
startdate=dt.datetime(2020,2,1)
enddate=dt.datetime(2020,3,1)

titles=['S&P 500 Close Price','S&P 500 Normalized Bull and Bear Return']
variables=['Close','mcnr']
fmplot(dfmc,variables,startdate=startdate,enddate=enddate,legend_fontsize=14,
               plottypes=['line','mktcycle'],stemlw=8,llocs=['upper left','upper right'],
               figsize=figsize,fb=recessions,sharex=True, hspace=0,ylims=['',(-3,5)],xtick_labelsize=18,
               titles=titles,titlexy=[(0.5,0.9),(0.5,0.8)],height_ratios=[2,1],hlines =['',4.5])
```


 <figure>
 <img alt="Bull and Bear Markets COVID 2020, February to March" title="Bull and Bear Market Cycles, Feb to March 2020" src="/images/FinancialMarkets/MktCycleZoomin3.png" width="635">
 <figcaption>Figure 4b. S&P500 close price and market cycle from February 1, 2020 to March 1, 2020</figcaption>
 </figure>

 <figure>
  <img alt="Bull and Bear Markets COVID 2020 BEAR" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MktCycleZoomin2.png" width="635">
  <figcaption>Figure 4b. S&P500 close price and market cycle from February 1, 2020 to April 1, 2020</figcaption>
  </figure>

# Machine Learning Variables

   Several variables that will be useful for machine learning are graphed below. It is essential to understand which variables are appropriate for machine learning and which ones are not.

  The *mkt* variable is employed as the target variable (dependent variable) variable for machine learning. That is, a machine learning algorithm is trained to predict *mkt*.  If a machine perfectly predicts this variable, it amounts to trading only when the market is in an upwardly trending condition and in very significant gains. Such a situation would result in "beating the market." Perfectly predicting *mkt* is extremely difficult, but it is possible to predict it with high accuracy, as we will see in Part 3.

  *Close*, *mucdown*, *mdcup*, and *mcupm* are useful as machine learning features, meaning predictor variables, after proper normalization. These signals are described as follows.
  * *Close* - this variable is simply the daily market close price and will need to be properly normalized for use as a machine learning feature variable.
  * *mcupm* - This signal is generated by *fmcycles()* and marks the point in time when the market is known to be in up or down condition, without retroactive analysis. For example, the market is in a Bull upward trend condition, and a Bear market is not yet detected.
  * *mucdown* - This signal is generated by *fmcycles()*. When in a Bull market condition, *mucdown* is the percent down from the previously detected market high.
  * *mdcup* - This signal is generated by *fmcycles()*. When in a Bear market condition, *mdcup* is the percent up form the previously detected low.

  The variable that should not be used for machine learning is *mcnr*. The *mcnr* variable, as described above, is derived by retroactively identifying the market condition. It must not be used for prediction, or "leakage" will occur. Leakage is when the dependent variable leaks back into the machine learning features. In such a case, the machine learning algorithm will unfairly learn and appear to work very well during the training phase, but it will usually perform less effectively in the real world prediction phase due to poor generalization.

```
startdate=dt.datetime(2017,2,1)
enddate=dt.datetime(2020,8,1)


title=['Bull and Bear Normalized Returns', 'Close',' MKT', 'mucdown and mdcup from last high or low']
variables=['mcnr','Close','mkt',['mucdown','mdcup']]
fmplot(dfmc,variables,titles=title,startdate=startdate,enddate=enddate,stemlw=2,fb=recessions,
          plottypes=['mktcycle','line','line','line'],
          hspace=0.00,titlein=False, figsize=(18,12),titledate=True)

```

<figure>
 <img alt="Bull and Bear Markets 1950 to 2020 SP500" title="Bull and Bear Market Cycles, SP500 1950-2020" src="/images/FinancialMarkets/MktMLVariables.png" width="635">
 <figcaption><center> </center></figcaption>
 </figure>

# Summary and Conclusions

  In summary, this post is the first in a three-part series. This article (Part 1) contributes two functions for analyzing the market. The *fmcycle()* function analyzes close price information to identify Bull and Bear market conditions, while *fmplot()* offers an easy to use plotting tool necessary for visualizing time series based stock market data. The ultimate objective of this blog series is to develop a machine learning model for the prediction of Bull and Bear market conditions. Part 2 explores and analyzes additional data sources for use by the predictive model, and Part 3 develops the predictive model and tests the resulting financial performance with backtesting.

 The result of applying *fmcycle()* to the S&P 500 data downloaded from Yahoo Finance is the generation of the detailed and summary market cycle dataframes, dfmc and dfmcsummary. The summary dataframe contains start and end Bull and Bear market cycles, including *mcnr* (Market Cycle Normalized Return). The results for start, end, and normalized return for each Bear and Bull market cycle match those reported elsewhere back to 1950. The detailed dataframe contains the *mkt* variable for each trading day marked as either +1 or -1, indicating the market is in a Bull (upward trend) condition or Bear (downward trend) condition. The detailed data frame also contains the daily *mcnr* relative to the start of the current cycle.

 Essential insights are gained by plotting the dfmc, *mcnr* variable with the *fmplot()* and observing the detailed market cycle behavior. Numerous insights are observed from annotations for Bull Markets and recessions, which are useful for understanding market behavior and thus building a market cycle prediction model. Additional insight is learned by zooming into specific dates and comparing the *mktcycle* plot with line plots of the market *close* price.

 The *fmcycles* function also generates variables that are essential for developing a market cycle prediction model. The *mkt* variable is employed in a machine learning prediction model, as the target variable (i.e., "label"). It is important to note that the *mcnr* variable is not appropriate to use as a prediction variable, since it is derived retroactively from future dates, as is the target variable *mkt*. Additional variables generated by *fmcycle()* and useful for machine learning are *mucdown*, *mcdup*, and *mcupm* signals, as described earlier in this article. These variables will be explored further in Parts 2 and 3 of this article series.
